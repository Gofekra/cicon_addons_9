<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <record model="ir.ui.view" id="cmms_store_invoice_tree">
            <field name="name">cmms.store.invoice.tree</field>
            <field name="model">cmms.store.invoice</field>
           <field name="arch" type="xml" >
                <tree string="Store Invoice">
                    <field name="inv_ref" />
                    <field name="inv_date"/>
                    <field name="inv_name"/>
                </tree>
            </field>
        </record>


     <record model="ir.ui.view" id="cmms_store_invoice_form">
        <field name="name">cmms.store.invoice.form</field>
        <field name="model">cmms.store.invoice</field>
        <field name="arch" type="xml" >
            <form string="Store Invoice">
                <sheet>
                 <group>
                     <group>
                        <field name="inv_id"/>
                        <field name="inv_ref"/>
                        <field name="inv_date"/>
                     </group>
                     <group>
                         <field name="inv_name"/>
                        <field name="company_id"/>
                         <field name="qb_ref"/>
                     </group>
                 </group>
                    <field name="invoice_line_ids">
                        <tree editable="bottom">
                            <field name="qb_line_ref" />
                            <field name="product_id"/>
                            <field name="prod_name"/>
                            <field name="prod_desc"/>
                            <field name="job_code" />
                            <field name="unit_price"/>
                            <field name="quantity"/>
                            <field name="job_order_id"/>
                            <field name="amount" sum="Total"/>
                        </tree>
                    </field>
                </sheet>
            </form>
        </field>
    </record>


        <record model="ir.ui.view" id="cmms_store_invoice_line_tree">
            <field name="name">cmms.store.invoice.line.tree</field>
            <field name="model">cmms.store.invoice.line</field>
           <field name="arch" type="xml" >
                <tree string="Store Invoice Line">
                    <field name="invoice_id"/>
                      <field name="qb_line_ref" />
                     <field name="product_id"/>
                     <field name="prod_name"/>
                     <field name="prod_desc"/>
                     <field name="job_order_id"/>
                     <field name="machine_id"/>
                    <field name="unit_price"/>
                    <field name="quantity"/>
                    <field name="amount" sum="Total"/>
                    <field name="spare_part_type_id"/>
                </tree>
            </field>
        </record>

          <record model="ir.ui.view" id="cmms_store_invoice_line_search">
			  <field name="name">cmms.store.invoice.line.search</field>
            <field name="model">cmms.store.invoice.line</field>
			<field name="arch" type="xml" >
                <search string="Store Invoice Line" >
                    <field name="invoice_id"/>
                    <field name="job_order_id"/>
                    <field name="machine_id"/>
                    <filter name="last_month" string="Last Month" domain="[('invoice_id.inv_date','&gt;=',(context_today()-relativedelta(months=1)).strftime('%%Y-%%m-01')),('invoice_id.inv_date','&lt;',time.strftime('%%Y-%%m-01'))]" />
                    <seperator/>
                    <filter name="this_month" string="This Month" domain="[('invoice_id.inv_date','&gt;=',(context_today()).strftime('%%Y-%%m-01')),('invoice_id.inv_date','&lt;',(context_today()+relativedelta(months=1)).strftime('%%Y-%%m-01'))]" />
                    <seperator/>
                    <filter name="pending" string="Without Job Order" domain="[('job_order_id','=',False)]" help="Not Mapped To any Job Order" />
                    <seperator/>
                    <filter name="part_type" string="Part Type- Un-Assigned" domain="[('spare_part_type_id','=',False)]" help="Not Assigned to Part Type" />


                </search>

			</field>
        </record>



          <record id="action_recon_job_order" model="ir.actions.server">
            <field name="name">Re-Check Job Order</field>
            <field name="model_id" ref="model_cmms_store_invoice_line"/>
            <field name="state">code</field>
            <field name="code">
                self.set_job_order(cr,uid,context.get('active_ids'),context=context)
            </field>
        </record>

        <record model="ir.values" id="action_recon_job_order_key">
            <field name="name">Re-Calculate - Job Order</field>
            <field name="action_id" ref="action_recon_job_order" />
            <field name="value" eval="'ir.actions.server,' + str(ref('action_recon_job_order'))" />
            <field name="key">action</field>
            <field name="model">cmms.store.invoice.line</field>
            <field name="key2">client_action_multi</field>
        </record>




        <record model="ir.actions.act_window" id="action_cmms_store_invoice">
            <field name="name" >Store Invoice</field>
            <field name="res_model">cmms.store.invoice</field>

        </record>

         <record model="ir.actions.act_window" id="action_cmms_store_invoice_line">
            <field name="name" >Store Invoice Line</field>
            <field name="res_model">cmms.store.invoice.line</field>
        </record>

         <record model="ir.ui.view" id="cmms_spare_part_type_tree">
            <field name="name">cmms.spare.part.type.tree</field>
            <field name="model">cmms.spare.part.type</field>
           <field name="arch" type="xml" >
                <tree string="Parts Type" editable="bottom">
                    <field name="name"/>
                </tree>
            </field>
        </record>


         <record model="ir.actions.act_window" id="action_cmms_spare_part_type">
            <field name="name" >Spare Part Type</field>
            <field name="res_model">cmms.spare.part.type</field>
        </record>


              <record model="ir.ui.view" id="cmms_machine_form_view_store">
            <field name="name">cmms.machine.form.store</field>
            <field name="model">cmms.machine</field>
             <field name="inherit_id" ref="cmms_machine_form_view"/>
            <field name="arch" type="xml" >
                <xpath expr="//header/div" postision="inside">
                    <button name="%(action_cmms_store_invoice_line)d"
                                        type="action"
                                        class="oe_inline oe_stat_button"
                                        icon="fa-money"
                                        widget="statinfo"
                                        context="{'search_default_machine_id': active_ids}"
                                         help="Parts Cost">
                                   <field name="parts_cost" widget="statinfo"/>
                    </button>
                </xpath>
            </field>
        </record>


        <menuitem name="Store" parent="cmms_menu" id="cmms_machine_store_menu" sequence="50"/>
        <menuitem  parent="cmms_machine_store_menu" id="cmms_store_invoice_menu" sequence="10" action="action_cmms_store_invoice"/>

        <menuitem  parent="cmms_machine_store_menu" id="cmms_store_invoice_line_menu" sequence="20" action="action_cmms_store_invoice_line"  />

        <menuitem name="Store Config" parent="cmms_config_menu" id="cmms_store_config_menu" sequence="40"/>
        <menuitem parent="cmms_store_config_menu" id="cmms_part_type_menu" action="action_cmms_spare_part_type"/>

    </data>
</openerp>




